# Takes CBCMAC authentication, decodes taking the first character of the auth and altering it then XOR it then re encode it base64

require 'base64'
require 'uri'

iv = "C9wWKGKY3lo%3D"
auth = "YmRtaW5pc3RyYXRvci0tpWMFKba1Jjc%3D"

div = Base64.decode64(URI.unescape(iv))
dauth = Base64.decode64(URI.unescape(auth))

puts div
puts dauth

# malicious_iv[0] = ('a'.ord^'b'.ord^div[0].ord).chr
#
div[0] = ('a'.ord^'b'.ord^div[0].ord).chr
dauth[0] = 'a'

newiv = URI.escape(Base64.strict_encode64(div),"+=/")
newauth = URI.escape(Base64.strict_encode64(dauth),"+=/")
puts newiv
puts newauth
